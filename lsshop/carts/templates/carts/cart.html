{% extends 'layout.html' %}

{% load static %}

{% block body %}
    <div style="margin-top: 200px;">
        <section class="section-content padding-y bg">
            <div class="container"> 
                {% if not cart_items %}
                    <h2 class="text-center">Your shopping cart is empty.</h2>
                    <br>
                    <div class="text-center">
                        <a href="{% url 'products:products' %}" class="btn btn-primary">Continue Shopping</a>
                    </div>
                {% else %}
                    <h2 class="mb-4">Cart</h2>
                    <div class="row">
                        <aside class="col-lg-9">
                            <div class="card">
                                <table class="table table-borderless table-shopping-cart">
                                    <thead class="text-muted">
                                        <tr class="small text-uppercase">
                                            <th scope="col">Product</th>
                                            <th scope="col" width="120">Quantity</th>
                                            <th scope="col" width="120">Price</th>
                                            <th scope="col" class="text-right" width="200"> </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for cart_item in cart_items %}
                                        <tr class="align-middle">
                                            <!-- Product Info -->
                                            <td>
                                                <div class="d-flex flex-column flex-sm-row align-items-center">
                                                    <img src="{{ cart_item.product.color_variant.front_image.url }}" class="img-thumbnail me-sm-3 mb-2 mb-sm-0" width="100" alt="{{ cart_item.product.color_variant.product.product_name }}">
                                                    <div class="flex-grow-1 text-center text-sm-start">
                                                        <a href="{{ cart_item.product.color_variant.product.get_url }}" class="text-dark fw-semibold mb-1 d-block">{{ cart_item.product.color_variant.product.product_name }}</a>
                                                        <small class="text-muted d-block">
                                                            <span class="me-2"><strong>Color:</strong> {{ cart_item.product.color_variant.color }}</span>
                                                            <span><strong>Size:</strong> {{ cart_item.product.size }}</span>
                                                        </small>
                                                        <div class="text-success fw-bold mt-1">${{ cart_item.product.color_variant.product.price }}</div>
                                                    </div>
                                                </div>
                                            </td>

                                            <!-- Quantity Controls -->
                                            <td class="text-center">
                                                <div class="d-flex justify-content-center justify-content-sm-start align-items-center">
                                                    <a class="btn btn-outline-secondary btn-sm me-1" type="button" href="{% url 'carts:remove_cart' cart_item.product.id %}">
                                                        <i class="bi bi-dash-square-fill"></i>
                                                    </a>
                                                    <input type="text" class="form-control text-center px-1" value="{{ cart_item.quantity }}" readonly style="width: 50px;">
                                                    <a class="btn btn-outline-secondary btn-sm ms-1" type="button" href="{% url 'carts:add_cart' cart_item.product.id %}">
                                                        <i class="bi bi-plus-square-fill"></i>
                                                    </a>
                                                </div>
                                            </td>

                                            <!-- Subtotal -->
                                            <td class="text-center text-sm-start">
                                                <div class="d-flex flex-column align-items-center align-items-sm-start">
                                                    <span class="fw-bold">${{ cart_item.sub_total }}</span>
                                                </div>
                                            </td>

                                            <!-- Remove Button -->
                                            <td class="text-center text-sm-end">
                                                <a href="{% url 'carts:remove_cart_item' cart_item.product.id %}" class="btn btn-danger">
                                                    <i class="bi bi-trash-fill"></i> Remove
                                                </a>
                                            </td>
                                        </tr>
                                            {% if messages %}
                                                {% for message in messages %}
                                                    <div class="alert alert-{{ message.tags }} mt-2 mx-2" role="alert">
                                                        {{ message }}
                                                        <a href="{% url 'products:products' %}">Continue Shopping.</a>
                                                    </div>
                                                {% endfor %}
                                            {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div> <!-- card.// -->
                        </aside> <!-- col.// -->

                        <aside class="col-lg-3">
                            <div class="card">
                                <div class="card-body">
                                    <dl class="dlist-align">
                                        <dt>Total price:</dt>
                                        <dd class="text-right">${{ total }}</dd>
                                    </dl>
                                    <dl class="dlist-align">
                                        <dt>Delivery Fees:</dt>
                                        <dd class="text-right"> ${{ delivery_tax }}.00</dd>
                                    </dl>
                                        <dl class="dlist-align">
                                        <dt>Total:</dt>
                                    <dd class="text-right text-dark b"><strong>${{ grand_total }}</strong></dd>
                                    </dl>
                                    <hr>
                                    <div class="d-flex flex-column align-items-center">
                                        <p class="text-center mb-3">
                                            <img src="{% static 'images/payments.png' %}" height="26">
                                        </p>
                                        <a href="#" class="btn btn-primary btn-block"> Checkout </a>
                                        <a href="{% url 'products:products' %}" class="btn btn-light btn-block mt-2">Continue Shopping</a>
                                    </div>
                                </div> <!-- card-body.// -->
                            </div> <!-- card.// -->
                        </aside> <!-- col.// -->
                    </div> <!-- row.// -->
                {% endif %}
            </div> <!-- container .//  -->
        </section>
    </div>
{% endblock %}